import React, { useState } from 'react';\nimport {\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  Button,\n  FormControl,\n  FormLabel,\n  RadioGroup,\n  FormControlLabel,\n  Radio,\n  Switch,\n  Slider,\n  Box,\n  Typography,\n  Grid,\n  Chip,\n  IconButton,\n  Divider,\n} from '@mui/material';\nimport { Close, Palette, Visibility, Contrast } from '@mui/icons-material';\nimport { useSettings, COLOR_PRESETS } from '../contexts/SettingsContext';\nimport { DynamicBrailleCell } from '../utils/brailleCellGenerator';\n\ninterface SettingsDialogProps {\n  open: boolean;\n  onClose: () => void;\n}\n\nconst SettingsDialog: React.FC<SettingsDialogProps> = ({ open, onClose }) => {\n  const { settings, updateSettings, resetSettings } = useSettings();\n  const [tempHue, setTempHue] = useState(settings.primaryHue);\n\n  const handleColorPreset = (hue: number) => {\n    setTempHue(hue);\n    updateSettings({ primaryHue: hue });\n  };\n\n  const handleHueChange = (event: Event, newValue: number | number[]) => {\n    const hue = Array.isArray(newValue) ? newValue[0] : newValue;\n    setTempHue(hue);\n    updateSettings({ primaryHue: hue });\n  };\n\n  // Convert hue to HSL color for preview\n  const getPreviewColor = (hue: number) => `hsl(${hue}, 80%, 50%)`;\n\n  return (\n    <Dialog \n      open={open} \n      onClose={onClose} \n      maxWidth=\"md\" \n      fullWidth\n      PaperProps={{\n        sx: { borderRadius: 3 }\n      }}\n    >\n      <DialogTitle sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\n        <Typography variant=\"h5\" component=\"div\">\n          ⚙️ Settings & Appearance\n        </Typography>\n        <IconButton onClick={onClose} size=\"small\">\n          <Close />\n        </IconButton>\n      </DialogTitle>\n      \n      <DialogContent dividers>\n        <Grid container spacing={4}>\n          {/* Theme Settings */}\n          <Grid item xs={12} md={6}>\n            <Box sx={{ mb: 3 }}>\n              <Typography variant=\"h6\" gutterBottom sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>\n                <Visibility /> Display Mode\n              </Typography>\n              \n              <FormControl component=\"fieldset\" sx={{ mb: 2 }}>\n                <FormLabel component=\"legend\">Color Mode</FormLabel>\n                <RadioGroup\n                  value={settings.colorMode}\n                  onChange={(e) => updateSettings({ colorMode: e.target.value as any })}\n                >\n                  <FormControlLabel value=\"light\" control={<Radio />} label=\"Light\" />\n                  <FormControlLabel value=\"dark\" control={<Radio />} label=\"Dark\" />\n                  <FormControlLabel value=\"system\" control={<Radio />} label=\"System Default\" />\n                </RadioGroup>\n              </FormControl>\n\n              <FormControlLabel\n                control={\n                  <Switch\n                    checked={settings.highContrast}\n                    onChange={(e) => updateSettings({ highContrast: e.target.checked })}\n                  />\n                }\n                label={\n                  <Box>\n                    <Typography variant=\"body2\">High Contrast Mode</Typography>\n                    <Typography variant=\"caption\" color=\"text.secondary\">\n                      Increases contrast and uses variable weight fonts\n                    </Typography>\n                  </Box>\n                }\n              />\n            </Box>\n\n            <Divider sx={{ my: 3 }} />\n\n            {/* Color Settings */}\n            <Box sx={{ mb: 3 }}>\n              <Typography variant=\"h6\" gutterBottom sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>\n                <Palette /> Theme Color\n              </Typography>\n              \n              <Box sx={{ mb: 2 }}>\n                <Typography variant=\"body2\" gutterBottom>Color Presets:</Typography>\n                <Box sx={{ display: 'flex', flexWrap: 'wrap', gap: 1, mb: 2 }}>\n                  {COLOR_PRESETS.map((preset) => (\n                    <Chip\n                      key={preset.name}\n                      label={preset.name}\n                      onClick={() => handleColorPreset(preset.hue)}\n                      variant={tempHue === preset.hue ? \"filled\" : \"outlined\"}\n                      sx={{\n                        backgroundColor: tempHue === preset.hue ? getPreviewColor(preset.hue) : 'transparent',\n                        color: tempHue === preset.hue ? 'white' : 'inherit',\n                        borderColor: getPreviewColor(preset.hue),\n                      }}\n                    />\n                  ))}\n                </Box>\n              </Box>\n\n              <Box sx={{ mb: 2 }}>\n                <Typography variant=\"body2\" gutterBottom>Custom Hue:</Typography>\n                <Box sx={{ px: 2 }}>\n                  <Slider\n                    value={tempHue}\n                    onChange={handleHueChange}\n                    min={0}\n                    max={359}\n                    step={1}\n                    marks={[\n                      { value: 0, label: 'Red' },\n                      { value: 60, label: 'Yellow' },\n                      { value: 120, label: 'Green' },\n                      { value: 180, label: 'Cyan' },\n                      { value: 240, label: 'Blue' },\n                      { value: 300, label: 'Magenta' },\n                    ]}\n                    sx={{\n                      '& .MuiSlider-thumb': {\n                        backgroundColor: getPreviewColor(tempHue),\n                      },\n                      '& .MuiSlider-track': {\n                        background: `linear-gradient(to right, \n                          hsl(0, 80%, 50%), hsl(60, 80%, 50%), hsl(120, 80%, 50%), \n                          hsl(180, 80%, 50%), hsl(240, 80%, 50%), hsl(300, 80%, 50%), hsl(360, 80%, 50%))\n                        `,\n                      },\n                    }}\n                  />\n                </Box>\n              </Box>\n            </Box>\n          </Grid>\n\n          {/* Braille Cell Settings */}\n          <Grid item xs={12} md={6}>\n            <Typography variant=\"h6\" gutterBottom sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>\n              <Contrast /> Braille Display Options\n            </Typography>\n\n            <FormControl component=\"fieldset\" sx={{ mb: 3, width: '100%' }}>\n              <FormLabel component=\"legend\">Outline Box</FormLabel>\n              <Typography variant=\"caption\" color=\"text.secondary\" sx={{ mb: 1, display: 'block' }}>\n                Shows bounding box around dot positions to visualize negative space\n              </Typography>\n              <RadioGroup\n                value={settings.outlineBox}\n                onChange={(e) => updateSettings({ outlineBox: e.target.value as any })}\n              >\n                <FormControlLabel value=\"off\" control={<Radio />} label=\"Off\" />\n                <FormControlLabel value=\"solid-light\" control={<Radio />} label=\"Solid Light\" />\n                <FormControlLabel value=\"solid-dark\" control={<Radio />} label=\"Solid Dark\" />\n                <FormControlLabel value=\"outline-light\" control={<Radio />} label=\"Outline Light\" />\n                <FormControlLabel value=\"outline-dark\" control={<Radio />} label=\"Outline Dark\" />\n              </RadioGroup>\n            </FormControl>\n\n            <FormControl component=\"fieldset\" sx={{ mb: 3, width: '100%' }}>\n              <FormLabel component=\"legend\">Ghost Dots</FormLabel>\n              <Typography variant=\"caption\" color=\"text.secondary\" sx={{ mb: 1, display: 'block' }}>\n                Shows faint dots at all positions to help visualize patterns\n              </Typography>\n              <RadioGroup\n                value={settings.ghostDots}\n                onChange={(e) => updateSettings({ ghostDots: e.target.value as any })}\n              >\n                <FormControlLabel value=\"off\" control={<Radio />} label=\"Off\" />\n                <FormControlLabel value=\"dot-light\" control={<Radio />} label=\"Dot Light\" />\n                <FormControlLabel value=\"dot-dark\" control={<Radio />} label=\"Dot Dark\" />\n                <FormControlLabel value=\"outline-light\" control={<Radio />} label=\"Outline Light\" />\n                <FormControlLabel value=\"outline-dark\" control={<Radio />} label=\"Outline Dark\" />\n              </RadioGroup>\n            </FormControl>\n\n            <FormControlLabel\n              control={\n                <Switch\n                  checked={settings.dotShadow}\n                  onChange={(e) => updateSettings({ dotShadow: e.target.checked })}\n                />\n              }\n              label=\"Dot Shadow\"\n            />\n\n            {/* Preview */}\n            <Box sx={{ mt: 3, p: 2, backgroundColor: 'background.paper', borderRadius: 2, border: '1px solid', borderColor: 'divider' }}>\n              <Typography variant=\"body2\" gutterBottom>Preview:</Typography>\n              <Box sx={{ display: 'flex', gap: 2, alignItems: 'center', justifyContent: 'center' }}>\n                <DynamicBrailleCell pattern=\"100000\" character=\"A\" size=\"large\" />\n                <DynamicBrailleCell pattern=\"110000\" character=\"B\" size=\"large\" />\n                <DynamicBrailleCell pattern=\"100100\" character=\"C\" size=\"large\" />\n              </Box>\n            </Box>\n          </Grid>\n        </Grid>\n      </DialogContent>\n\n      <DialogActions sx={{ p: 3 }}>\n        <Button onClick={resetSettings} color=\"inherit\">\n          Reset to Defaults\n        </Button>\n        <Button onClick={onClose} variant=\"contained\">\n          Done\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n};\n\nexport default SettingsDialog;